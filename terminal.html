<!-- /nick ime â†’ promena nicka

/clear â†’ brisanje chata

/help â†’ lista komandi -->

<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <title>React IRC Terminal â€“ FIXED</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <style>
    body {
      background: black;
      color: #00ff00;
      font-family: monospace;
      padding: 20px;
    }
    .terminal {
      border: 1px solid #00ff00;
      padding: 10px;
      width: 600px;
      height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .prompt {
      margin-top: 10px;
    }
    input {
      background: black;
      color: #00ff00;
      border: none;
      outline: none;
      width: 540px;
      font-family: monospace;
    }
  </style>
</head>
<body>

<div id="root"></div>

<script>
  const { useState, useEffect, useRef } = React;

  const STORAGE_KEY = "irc_log";

  function App() {
    const [nick, setNick] = useState(
      localStorage.getItem("irc_nick") || "guest"
    );
    const [input, setInput] = useState("");
    const [log, setLog] = useState(() => {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    });

    const termRef = useRef(null);

    function saveLog(newLog) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(newLog));
      setLog(newLog);
    }

    function pushLine(line) {
      saveLog([...log, line]);
    }

    function handleCommand(cmd) {
      const [command, arg] = cmd.split(" ");

      if (command === "/nick" && arg) {
        setNick(arg);
        localStorage.setItem("irc_nick", arg);
        pushLine(`* nick promenjen u ${arg}`);
        return true;
      }

      if (command === "/clear") {
        localStorage.removeItem(STORAGE_KEY);
        setLog([]);
        return true;
      }

      if (command === "/help") {
        pushLine("Komande:");
        pushLine("/nick ime");
        pushLine("/clear");
        pushLine("/help");
        return true;
      }

      return false;
    }

    function submit() {
      if (!input.trim()) return;

      if (!handleCommand(input)) {
        pushLine(`<${nick}> ${input}`);
      }

      setInput("");
    }

    /* REAL-TIME SYNC IZMEÄU TABOVA */
    useEffect(() => {
      function onStorage(e) {
        if (e.key === STORAGE_KEY) {
          setLog(JSON.parse(e.newValue) || []);
        }
      }
      window.addEventListener("storage", onStorage);
      return () => window.removeEventListener("storage", onStorage);
    }, []);

    /* AUTO SCROLL */
    useEffect(() => {
      termRef.current.scrollTop = termRef.current.scrollHeight;
    }, [log]);

    return React.createElement(
      "div",
      null,

      React.createElement("h3", null, "ðŸ–¥ IRC Terminal"),

      React.createElement(
        "div",
        { className: "terminal", ref: termRef },
        log.map((line, i) =>
          React.createElement("div", { key: i }, line)
        )
      ),

      React.createElement(
        "div",
        { className: "prompt" },
        React.createElement("span", null, nick + "> "),
        React.createElement("input", {
          value: input,
          onChange: e => setInput(e.target.value),
          onKeyDown: e => e.key === "Enter" && submit(),
          autoFocus: true
        })
      )
    );
  }

  ReactDOM
    .createRoot(document.getElementById("root"))
    .render(React.createElement(App));
</script>

</body>
</html>
